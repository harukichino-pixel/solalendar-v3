# 空暦 Solalendar - 要件定義書 (Ver.2.0)

## 1. プロジェクト概要 (Project Overview)

### 1.1 ビジョン & ミッション
* **Vision:** 不安な時代を生き抜くための「心の羅針盤」を提供する。
* **Mission:** 従来の「占い」を、論理とデータに基づく**「運命構造解析（メタ認知）＆行動最適化ツール」**へと昇華させ、ユーザーに「心の平安」と「行動の確信」をもたらす。
* **Core Concept:** "Metacognition via Weather Forecast"
    * 複雑な運命学や心理学データを「天気予報」のメタファーで翻訳し、客観視させる。

### 1.2 ターゲットユーザー
* **Primary:** 30-40代のビジネス・カルチャー層、ミレニアル世代のSBNR層（Spiritual But Not Religious）。
* **Needs:** 「当たる/当たらない」の占いではなく、自己理解のための「構造的な説明」と、生活に実装可能な「具体的指針」を求めている。

---

## 2. コア・ロジック定義: The 3-Tier Architecture

本アプリの核となる解析エンジン「Solalendar Advanced Protocol」の定義。

### 2.1 Tier 1: The Core Kernel（本質・土壌）
* **定義:** ユーザーの「変えられない初期設定（OS）」。
* **役割:** AI分析用の内部コンテキストデータ（ユーザーには直接見せない）。Tier 2における「予測」と「リアクション」の根拠となる。
* **データソース:** 以下の4クラスター・11暦を統合したJSONオブジェクト。
    * **Absolute:** ユリウス通日 (JDN), 天体座標 (NASA/JPL相当)。
    * **Solar (Structure):** グレゴリオ暦, トロピカル方式 (西洋占星術)。
    * **Lunar (Rhythm):** 天保暦(旧暦), 干支暦(60干支), 二十四節気・七十二候, サイデリアル方式(インド占星術)。
    * **Archetypal (Count):** ツォルキン, 13の月の暦, 数秘術。

### 2.2 Tier 2: The Dynamic Probe（動的問診・観測）
* **定義:** Tier 1の仮説を検証し、現状を測定するための**「対話型スキャン（儀式）」**。
* **ロジック名:** 「空暦B5V (Solalendar B5V)」
    * **Layer A (Engine):** VALS (8タイプ) - 「何のために走るか（動機）」
    * **Layer B (OS):** BigFive (5因子) - 「どう制御するか（特性）」
* **入力仕様:** 50問以上の高解像度アンケート（フルスペック）。
* **リスク回避策:**
    * **Prediction & Reaction:** Tier 1の予測と回答が一致すれば「同期（Sync）」、異なれば「驚き（Gap）」のリアクションをAIがリアルタイムで返すことで、入力をエンタメ化する。

### 2.3 Tier 3: Social Persona（社会的ペルソナ・天気）
* **定義:** Tier 2の回答結果から導き出される「現在の社会適応状態」。
* **メタファー:** 「今日着ている服」や「現場の天候」。
* **分析ゴール:** Tier 1（本質）とTier 3（現状）の**乖離（Conflict）**を測定し、「役割疲労」の原因を特定する。

---

## 3. UXフロー: "The Tuning Ritual" (共鳴の儀式)

50問の入力を「作業」ではなく「没入体験」にするための3フェーズ構成。

### Phase 1: The Core Calibration（基礎OSの確認）
* **対象:** BigFive（特性）
* **体験:** 「あなたの星（Tier 1）と現状のズレを確認します」
    * ユーザー回答に対し、AIが即座にフィードバック。
    * *「おや？ 星は『慎重』を示していますが、今のあなたは『大胆』ですね。（メモ）」*

### Phase 2: The Drive Test（エンジンの確認）
* **対象:** VALS（動機・価値観）
* **体験:** 「魂が求める方向を確認します」
    * **A/B天秤UI:** 2つの価値観（例：「完璧な成果」vs「未完成の独創性」）を提示し、直感で選ばせる。

### Phase 3: The Resource Check（燃料の確認）
* **対象:** VALS（リソース・行動力）
* **体験:** 「現在のエネルギー残量を測定します」
    * テンポの良いスピード回答。終了後、即座に**「シンクロ率 ○○%」**を表示し、レポートへ遷移。

---

## 4. アウトプット: The Metacognition Report

### 4.1 The Core Personality Matrix
* **内容:** 「エンジン（VALS）」×「制御OS（BigFive）」の組み合わせによるアーキタイプ診断。
* **表現:** 抽象的な性格記述ではなく、**「ブレーキを踏みながらアクセル全開の状態」**といった力学的な描写。

### 4.2 The Conflict & Harmony
* **内容:** Tier 1とTier 3のギャップ解析。
* **目的:** 「役割疲労」を**「社会適応のための高度な戦略」**として承認・リフレーミングし、罪悪感を取り除く。

### 4.3 Behavioral Optimization
* **内容:** 生活に実装可能な具体的行動プロトコル。
    * **Persona Strategy:** ON/OFFの切り替えスイッチの提案。
    * **Weekly Routine:** 「水曜日は情報を遮断する」等の具体的スケジュール。

### 4.4 Tuning (事後補正)
* **機能:** 診断結果に違和感がある場合、ユーザーがスライダー等で微調整できる機能。
* **目的:** 「外れ」を「AIとの対話」に変え、自分だけの羅針盤を作り上げる。

---

## 5. 技術・データ要件 (Technical Requirements)

### 5.1 計算エンジン (Back-end Logic)
* **天体位置:** Swiss Ephemeris (NASA JPL同等精度) を採用。
* **暦計算:** Pythonライブラリ (qreki, lunar-python) を使用し、サーバーサイドで計算完結させる。
* **宇宙天気:** NOAA APIより太陽フレア/地磁気情報を取得（オプション）。

### 5.2 データベース (Master Data)
* **NAOJベース:** 国立天文台「暦要項」CSV（祝日・節気・月齢確定）。
* **コンテンツDB:**
    * **七十二候マスタ:** 現代語訳・詩的メッセージ。
    * **通書アクションマスタ:** 宜忌（Yi/Ji）の現代ビジネス用語訳。
    * **B5Vプロンプトマスタ:** VALS x BigFive の掛け合わせ解釈ロジック。

---

## 6. デザイン指針 (Design Guidelines)

* **Tone & Manner:** Intellectual, Minimal, Serene (静謐), Scientific.
* **Visuals:** データヴィジュアライゼーション（グラフ、波形、ヒートマップ）を多用し、「計測器」としての信頼感を演出。
* **Prohibited:** 紫色の水晶、魔法陣、過度な装飾、恐怖を煽る表現。

---

## 7. 開発ロードマップ (MVP Scope)

1.  **Tier 1 Engine実装:** 11暦の計算ロジックとJSON出力の実装。
2.  **B5V Prompt開発:** AIによる「動的問診」と「リアクション生成」のプロンプトエンジニアリング。
3.  **UI/UX実装:** "The Tuning Ritual" (カードUI/チャットUI) のフロントエンド開発。
4.  **Tuning UI実装:** 結果画面でのパラメータ調整機能の実装。

### 開発チームへの特記事項
本プロジェクトは「占いアプリ」ではありません。**「NASAや国立天文台のビッグデータを活用し、心理学フレームワーク（BigFive/VALS）で解析する、パーソナリティ・アーキテクチャ解析システム」**です。ユーザー体験のゴールは「的中」ではなく、「深い納得（腹落ち）」と「平安」です。